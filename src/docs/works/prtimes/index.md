---
title: PR TIMES
description: 株式会社PR TIMESでの取り組み
prev:
  text: "Findy Inc."
  link: "/works/findy"
next:
  text: "Presentation"
  link: "/works/presentation"
---

# PR TIMES

## 概要 

- 会社名: 株式会社PR TIMES
- 創業: 2005年12月26日
- 従業員数: 119名 (2024年2月末時点)
- 所属期間: 2022-02-01 - 2024-08-15
- 所属部署: 開発本部
- 職種: サーバーサイドエンジニア、機械学習エンジニア

## PHPerKaigi 2024 企業ブース企画「PHP 8.3秒チャレンジ」の開発

### 概要

PHPerKaigi 2024のブースゲーム「PHP 8.3秒チャレンジ」を開発しました．

- 期間: 2024-01 => 2024-03
- 役割: 計画者・実装者

### 技術

- 言語
    - `PHP`
    - `TypeScript`
- フレームワーク
    - `Leaf PHP`
    - `Pactum JS`
    - `React`
    - `Tailwind CSS`
- インフラストラクチャ
    - `Nginx`
    - `MySQL`
    - `Docker`
    - `AWS` (vpc, ec2の最小構成)

### 技術選定

- フロントエンド: 高機能ですぐに開発ができる`React`を使用しました。
- バックエンド: PHPのイベントなのでPHP 8.3を使用しました。
- データベース: PHPと相性の良いMySQLを使用しました。
- クラウドインフラ: AWSの最小構成としてEC2を利用しました。

### 詳細

PHPerKaigiはPHPに特化した技術カンファレンスであり、業界の最新技術やトレンドを学ぶことができる場です。スポンサー企業には専用ブースが用意され、自社技術やサービスの紹介、採用活動などを行うことができます。

前回のPHP Conference 2023では、スポンサー企業ブースでPHPに関するクイズ企画を実施しましたが、さまざまな課題が浮き彫りになりました。具体的には、クイズの難易度調整が困難であったこと、X（旧Twitter）などのSNSでの拡散があまり得られなかったこと、ブースに常時エンジニアを配置する必要があったこと、そして1回の体験に時間がかかってしまうことなどが挙げられます。

これらの反省をふまえ、今回のPHPerKaigi 2024では「PHP 8.3秒チャレンジ」という新たなゲーム型企画をチームで立案・開発することになりました。PHPの最新版である「8.3」にちなんだ、10秒ストップに近い時間を狙うタイムアタック型のゲームです。ゲーム終了後にはQRコードを表示し、SNSでのシェアを促すことで拡散を狙う仕組みとしました。

私は主にバックエンドとインフラの設計を担当し、APIサーバーの構築やフロントエンドのInfrastructure層（Repository層）の実装を担いました。インフラ構成はシンプルながら本番運用に耐えられるよう設計されており、限られた時間の中で高い安定性とパフォーマンスを両立させることが求められました。

本番のPHPerKaigi 2024では、3日間で140名以上の方にこのゲームをプレイしていただきました。当初の目的のひとつであったTwitter投稿が多く見られました(`#prtimes_dev`)。また、カンファレンス運営側や参加者からのフィードバックにおいても、高く評価されました。

### 参考

本プロジェクトの取り組みを次の記事でまとめております。

- [PR TIMES 開発者ブログ."PHPerKaigi2024のブース企画を担当しました！"](https://developers.prtimes.jp/2024/04/03/phperkaigi2024-booth/)
- [PR TIMES 開発者ブログ."PHPカンファレンス福岡2024に協賛・登壇しました！"](https://developers.prtimes.jp/2024/06/26/phpcon_fukuoka_2024_after/)

## PR TIMESの記事データの前処理バッチサーバーの開発

### 概要

PR TIMESの記事情報を誰でも利用可能にするために、前処理サーバーを作成しました。

- 期間: 2024-09 => 2024-03
- 役割: 計画者・実装者

### 技術

- 言語
    - `Python`
    - `SQL (PostgreSQL, BigQuery)`
- フレームワーク
    - `Prefect`
- インフラストラクチャ
    - Google Cloud(`BigQuery`, `Cloud Storage`, `Cloud Compute Engine`, `IAP`)

### 詳細

PR TIMESにはランキング機能があり、プレスリリース投稿者の目標になる人気の機能でした。実際、XなどのSNSで「PR TIMESのランキングに載りました」といったシェアが投稿されています。しかし、プレスリリースは日に1500本程公開されるため、総合ランキングの難易度が高すぎるという問題がありました。そこでプレスリリースのカテゴリー別のランキングの実装が決まりました。

私は、実装者として、携わりました。生のPHP, Smarty, Vanilla JavaScriptといった慣れない技術スタックでの開発でした。同僚エンジニアへの相談やペアでのプログラミングを通じてシステムへの理解を深め、機能実装できました。このプロジェクトは、二人で実装をしました。私はLayered Architectureで表現すると、Controller層・Service層(UseCase層)を担当し、もう一人の方がRepository層(Infrastructure層)を担当しました。

この実装の結果、ランキングに掲載できる企業数が増加しSNSでのシェアに利用しやすくなりました。

## PR TIMESの新規機能開発: カテゴリーごとのランキング

### 概要

PR TIMESの新規機能として，カテゴリーごとのランキングを実装しました。

- 期間: 2023-09 => 2023-11
- 役割: 実装者

### 技術

- 言語
    - `PHP`
    - `JavaScript`
    - `SQL (PostgreSQL)`
- フレームワーク
    - `Smarty (Template Engine)`
- インフラストラクチャ
    - `AWS` (`Opensearch`)

### 詳細

PR TIMESにはランキング機能があり、プレスリリース投稿者の目標になる人気の機能でした。実際、XなどのSNSで「PR TIMESのランキングに載りました」といったシェアが投稿されています。しかし、プレスリリースは日に1500本程公開されるため、総合ランキングの難易度が高すぎるという問題がありました。そこでプレスリリースのカテゴリー別のランキングの実装が決まりました。

私は、実装者として、携わりました。生のPHP, Smarty, Vanilla JavaScriptといった慣れない技術スタックでの開発でした。同僚エンジニアへの相談やペアでのプログラミングを通じてシステムへの理解を深め、機能実装できました。このプロジェクトは、二人で実装をしました。私はLayered Architectureで表現すると、Controller層・Service層(UseCase層)を担当し、もう一人の方がRepository層(Infrastructure層)を担当しました。

この実装の結果、ランキングに掲載できる企業数が増加しSNSでのシェアに利用しやすくなりました。

## 検索機能改善 (検索機能アルゴリズム開発)

### 概要

PR TIMESの検索機能のPoCを開発・提案し，その後，検索機能のアルゴリズム開発に相談役として携わりました．

- 期間: 2023-04 => 2023-05 (2023-06 => 2023-09)
- 役割: PoC開発者 => 技術相談役・技術調査役

### 技術

- PoC
    - `Python`
    - `MeCab`
    - `sklearn`
- Production
    - `PHP`
    - `AWS`(`Opensearch`)

### 詳細

2021年にPR TIMESの開発体制が現体制へと移行しましたが、当初はサービスの安定性が低く、いつ停止してもおかしくないような状態でした。特に、当時自前で運用されていた`ElasticSearch`は不安定で、2022年には`Opensearch`への移行が行われました。その後、2023年には一定の安定性を確保できたことから、検索機能自体の品質向上に取り組むことになりました。

検索機能は`Opensearch`で運用されていましたが、検索結果が期待どおりでないケースが多く、ユーザーからは「何が出てくるかわからないから、逆に面白い」といった皮肉交じりのフィードバックが寄せられるほどでした。こうした背景から、検索体験そのものを改善することが重要な課題となっていました。

私総合職と合同で行われた新卒研修の一環として、検索機能の改善案を考案・発表する課題に参加しました。このプロジェクトでは、開発職のメンバーとして技術的な観点からチームをリードし、検索アルゴリズムの構造と改善ポイントを洗い出す役割を担いました。

提案の中では、まず不要なデータの除去に着目しました。従来は記事本文すべてがインデックス対象となっていましたが、記事の後半には会社住所など検索には不要な情報が多く含まれていたため、前半のみをインデックス化することを提案しました。また、HTMLタグや文字参照がそのまま残っていたため、形態素解析（Tokenize）に悪影響を与えていたと推察し、文字列正規化処理の導入を提案しました。

加えて、これまでインデックス化されていなかったタイトルやサブタイトルも含めることで、検索精度の向上が期待できることを説明しました。さらに、検索アルゴリズムについても、単純なAND/OR検索から、TF-IDFベースのスコアリング手法(`Lucene's Practical Scoring Function`）への変更を提案しました。この手法により、重要なキーワードを含む記事がより上位に表示されるようになります。

提案の効果を実感してもらうために、私は個人でPoC（概念実証）を開発しました。チームのプレゼン準備中に時間が空いたこともあり、許可を得たうえで`Python`を使ってプロトタイプを作成。TF-IDFと`Lucene's Practical Scoring Function`に基づくスコア計算を`MeCab`や`scikit-learn`を活用して実装しました。スコアリング関数についてはライブラリが存在しなかったため、自前で実装しました。

このPoCを通じて、チーム内外で提案手法の有効性が認められ、一部の手法が採用されることとなりました。加えて、検索技術や自然言語処理に関する知見が評価され、私はその後も技術相談役・技術調査役として開発チームに貢献することになりました。

本番環境では、開発チームが中心となって改善施策を実装。短期間での開発が求められていたことから、既存技術を活かしつつ効率的な改善を行う方針となりました。OpenSearchは日本語の形態素解析は`kuromoji` での実装となりました。また、Luceneのスコアリング関数は実装コストの都合からTF-IDFのみの導入にとどまりましたが、それでも検索結果の品質は大きく向上し、十分な成果を上げることができました。

### AWS Opensearchの補足情報

Opensearchは2023年6月時点では日本語形態素解析器のうち`kuromoji`のみをサポートしていました。なお、2023年10月にsudachiがサポートされました。

https://aws.amazon.com/about-aws/whats-new/2023/10/amazon-opensearch-four-language-analyzers/

### 技術記事執筆及び登壇

この開発を通して、検索機能の内部を学びました。その経験を活かし、2024年にはPHPカンファレンス福岡で検索機能のアルゴリズムについての講演をしております。

- [日本語の単語分割APIを立てて他の言語で利用する](https://zenn.dev/shundeveloper/articles/f4b27300d9d9fa)
- [AND検索のポスティング走査アルゴリズムと実装](https://zenn.dev/shundeveloper/articles/f7d3e47e2e7c82)
- [OR検索のポスティング走査アルゴリズムと実装](https://zenn.dev/shundeveloper/articles/6a80e855a6cde3)
- [CfP: 作って学ぶ ★ 検索機能](https://fortee.jp/phpcon-fukuoka-2024/proposal/356e0c9c-fbc3-4c88-bb89-0ba3a03672bd)

## 機械学習を用いたPoCの開発

### 概要

Word2Vecを用いた類似度に基づく単語推薦システムをPoCとして開発、社内に公開しました。

- 期間: 2022-07 => 2023-09
- 役割: 開発者

### 技術

- 言語
    - `Python`
    - `JavaScript`
- ツール
    - `MeCab` (形態素解析器)
- フレームワーク
    - `Gensim`
    - `FastAPI`
    - `Next.js`
- インフラストラクチャ
    - `AWS` (`ec2`)
    - `GCP` (`IAP`)

### 詳細

PR TIMESの記事データには、プレスリリースに基づく大量の自然言語データが含まれており、公共性が高く、かつ正確な日本語で記述されていることから、機械学習モデルの学習データとして非常に適していると考えられました。一方で、社内ではこのデータの価値が十分に認知されておらず、その活用が進んでいないという課題がありました。

この課題を解決するために、PR TIMESのプレスリリースデータを活用し、Word2Vecを用いた単語ベクトルモデルを構築。構築したモデルを利用して、類似キーワードを推薦するシステムのPoCを開発しました。開発には、自然言語処理に適した形態素解析器MeCabや、Word2Vecの学習にGensimを使用し、APIはFastAPIで提供しました。

フロントエンドには社内での導入実績があり、開発効率の良いNext.jsを採用。インフラ面では、学習と配信にAWSのEC2を、社内アクセス制限のためにGCPのIAPを利用しました。PoCであることと、機密データと接続しないという要件から、シンプルにベーシック認証を用いてアクセス制限を行いました。

さらに、PoCを通じて得られた知見はエンジニアだけでなく、ビジネスサイドのメンバーにも共有され、データ活用の重要性や可能性について広く認識されるきっかけとなりました。また、このプロジェクトでは、日本語の新字体・旧字体の表記ゆれを解消する必要があり、独自に互換表を作成して前処理に組み込む工夫も行いました。

[新旧字体の表記ゆれを統一するために互換表を作成した話](https://developers.prtimes.jp/2022/11/18/change_word_form/)

